
# 1 常用web漏洞exploit

本目录下的exploit需要使用**pen.py exploit**命令执行，例如：

    pen.py exploit -e cms_joomla_3_4_session_object_injection.py -u http://192.168.14.157/joomla/ --attack

exploit必须放入*exploit*目录下，且不能放在子目录里

和*pen.py*的"google hacking"工具组合可实现批量漏洞检测/漏洞利用

例如：
    
google hacking获取discuz站点，并记录到*dc.txt*文件
    
    pen.py gh "inurl:faq.php?action=grouppermission" --unique -s 10 -o dc.txt

使用*Discuz 7 faq.php grouppermission SQL注入*这个exploit verify模式验证*dc.txt*中所有的discuz站点

    pen -e "faq.php" -u @tmp/dc.txt

---

# 2 exploit使用

exploit帮助信息，*pen.py exploit -h*

    usage: pen exploit [-h] [--createdb] [--register REGISTER] [--update UPDATE]
                       [--delete DELETE] [-q QUERY] [-l] [--detail DETAIL]
                       [-e EXECUTE] [-u URL] [--verify] [--attack]
                       [--cookie COOKIE] [--useragent USERAGENT]
                       [--referer REFERER] [--header HEADER] [--elseargs ELSEARGS]  

    optional arguments:
      -h, --help            show this help message and exit 

    exploit管理:
      --createdb            创建exploit信息数据库
      --register REGISTER   指定exploit目录或exploit文件注册exploit信息
      --update UPDATE       根据exploit文件更新exploit注册信息
      --delete DELETE       根据exploit名字删除exploit注册信息
      -q QUERY, --query QUERY
                            搜索exploit，参数格式column:keyword，column支持expName/os/webser
                            ver/language/appName，默认为expName
      -l, --list            列举所有exploit
      --detail DETAIL       根据exploit名称显示某个exploit的详细信息 

    exploit执行:
      -e EXECUTE, --execute EXECUTE
                            exploit执行，参数格式column:keyword，column支持expName/os/webser
                            ver/language/appName，默认为expName
      -u URL, --url URL     指定目标URL，使用@file指定url列表文件
      --verify              验证模式
      --attack              攻击模式
      --cookie COOKIE       指定Cookie
      --useragent USERAGENT
                            指定UserAgent
      --referer REFERER     指定referer
      --header HEADER       指定其他HTTP header,例如--header 'xxx=xxxx#yyy=yyyy'
      --elseargs ELSEARGS   指定其他参数,例如--elseargs 'xxx=xxxx#yyy=yyyy'

## -e/--execute

最重要的参数，用于指定执行某些exploit，有以下几种使用方式：

1、直接执行某个.py文件
    
    pen.py exploit -e cms_discuz_6_x7_x_cookie_rce.py -u http://xxx.com

2、根据exploit名字或名字中的关键字指定exploits

    pen.py exploit -e "faq.php" -u http://xxx.com   
    # 从exploit数据库中查找exploit名字包含"faq.php"的所有exploit并执行

3、根据其他字段关键字指定exploits

    pen.py exploit -e appName:discuz -u http://xxx.com   
    # 从exploit数据库中查找appName包含"discuz"关键字的所有exploit并执行

## -u/--url

最常用的参数，用于指定目的地址，可以是url，也可以使用*@file*指定url列表文件

## --cookie/--referer/--useragent

手工指定cookie、referer、useragent

## --header

自定义其他header，格式为*xxx=xxxx#yyy=yyyy*，这里使用*#*作为分隔符分割不同的header

## --elseargs

自定义某些exploit需要的专有参数，格式为*xxx=xxxx#yyy=yyyy*，这里使用*#*作为分隔符分割不同的自定义参数

例如*Discuz 备份文件短文件名爆破*这个exploit，需要指定”爆破深度“等信息，这些需要该参数的支持

    pen.py exploit -e "备份文件" -u http://127.0.0.1/discuz/x2.5/ --elseargs type=discuzx#date=16-02-28#days=5#dirs=2

## --verify/--attack

指定验证模式或攻击模式，前者仅验证漏洞是否存在，后者会进行攻击获取权限

## -l/--list

列举所有exploit

## -q/--query

查询exploit，可从*expName/os/webserver/language/appName*这几个字段查询exploit，格式为*column:keywords*默认搜索*expName*

例如：

    pen.py exploit -q "faq.php"
    # 搜索exploit名字中包含"faq.php"的exploit

    pen.py exploit -q appName:discuz
    # 搜索appName列，返回该列中包含"discuz"关键字的行

## --detail

根据exploit名称显示某个exploit的详细信息

## --delete 

根据exploit名字删除exploit注册信息

## --update

据exploit文件更新exploit注册信息

## --register

指定exploit目录或exploit文件注册exploit信息，一般情况下无需进行注册，所有exploit只要执行过一次都会自动注册

## --createdb

exploit模块的所有信息存储在*exploit*目录下的*exploit.db*数据库文件中，如果没有该数据库文件则需要先创建

---

# 3 exploit编写

---

# 4 注意事项

1. exploit文件名中不能包含'.'点号，否则会与python中包机制
